<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ホテル清掃管理</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: white;
            color: #1f2937;
        }
        
        /* ログイン選択画面 */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
        }
        
        .login-card {
            background: white;
            border-radius: 16px;
            padding: 48px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            max-width: 400px;
            width: 100%;
            margin: 20px;
        }
        
        .login-title {
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 16px;
            color: #1f2937;
        }
        
        .login-subtitle {
            font-size: 16px;
            text-align: center;
            color: #6b7280;
            margin-bottom: 40px;
        }
        
        .login-buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .login-btn {
            padding: 16px 24px;
            font-size: 18px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .login-btn:active {
            transform: translateY(0);
        }
        
        .login-btn.admin {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .login-btn.cleaner {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .login-icon {
            width: 24px;
            height: 24px;
        }
        
        /* メインアプリケーション */
        .app-container {
            display: none;
        }
        
        .app-container.active {
            display: block;
        }
        
        .container {
            min-height: 100vh;
            background: white;
        }
        
        /* ヘッダー */
        .header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 12px 16px;
        }
        
        .date-selector {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .date-btn {
            padding: 8px;
            background: none;
            border: none;
            color: #4b5563;
            cursor: pointer;
        }
        
        .date-display {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            font-weight: 500;
            position: relative;
            min-width: auto;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 4px 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .user-role {
            color: #667eea;
            font-weight: 600;
        }
        
        .logout-btn {
            padding: 5px 10px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .logout-btn:hover {
            background: #dc2626;
        }
        
        .logout-btn:active {
            transform: scale(0.95);
        }
        
        /* ステータスサマリー */
        .status-summary {
            padding: 0;
            background: white;
            position: relative;
        }
        
        .status-scroll-container {
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
        }
        
        .status-grid {
            display: flex;
            gap: 6px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            flex: 1;
            padding: 8px 0 0 0;
        }
        
        .status-grid::-webkit-scrollbar {
            display: none;
        }
        
        .scroll-arrow {
            width: 24px;
            height: 40px;
            background: none;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: opacity 0.2s;
            flex-shrink: 0;
        }
        
        .scroll-arrow:hover {
            opacity: 0.7;
        }
        
        .scroll-arrow svg {
            width: 20px;
            height: 20px;
            color: #6b7280;
        }
        
        /* 施設選択 */
        .facility-selector {
            padding: 8px 16px;
            background: white;
            display: flex;
            justify-content: center;
        }
        
        .facility-dropdown {
            width: 100%;
            padding: 8px 12px;
            font-size: 14px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            background: white;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .facility-dropdown:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .facility-dropdown:hover {
            border-color: #d1d5db;
        }
        
        .status-btn {
            padding: 6px 8px;
            font-size: 12px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            background: #f9fafb;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            min-height: 40px;
            min-width: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
        }
        
        .status-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }
        
        .status-count {
            font-size: 14px;
            font-weight: bold;
        }
        
        .status-btn:active {
            transform: scale(0.98);
        }
        
        .status-btn.active-red {
            background: #fef2f2;
            border-color: #fca5a5;
            color: #b91c1c;
        }
        
        .status-btn.active-green {
            background: #f0fdf4;
            border-color: #86efac;
            color: #15803d;
        }
        
        .status-btn.active-gray {
            background: #f3f4f6;
            border-color: #d1d5db;
            color: #4b5563;
        }
        
        .status-btn.active-blue {
            background: #eff6ff;
            border-color: #93c5fd;
            color: #1d4ed8;
        }
        
        .status-btn.active-purple {
            background: #faf5ff;
            border-color: #c4b5fd;
            color: #7c3aed;
        }
        
        .status-btn.active-orange {
            background: #fff7ed;
            border-color: #fdba74;
            color: #ea580c;
        }
        
        .status-btn.active-blue {
            background: #eff6ff;
            border-color: #93c5fd;
            color: #1d4ed8;
        }
        
        .status-btn.active-purple {
            background: #faf5ff;
            border-color: #d8b4fe;
            color: #7c3aed;
        }
        
        .status-btn.half-width {
            flex: 0 0 calc(33.333% - 4px);
        }
        
        .status-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .status-count {
            font-weight: bold;
            font-size: 18px;
        }
        
        /* AI清掃ルート */
        .ai-route-section {
            background: linear-gradient(135deg, #bae6fd 0%, #7dd3fc 100%);
            color: #0c4a6e;
            margin: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .ai-route-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            cursor: pointer;
        }
        
        .ai-route-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 14px;
        }
        
        .ai-icon {
            width: 20px;
            height: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .toggle-icon {
            width: 20px;
            height: 20px;
            transition: transform 0.3s;
        }
        
        .toggle-icon.open {
            transform: rotate(180deg);
        }
        
        .ai-route-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: rgba(255, 255, 255, 0.3);
        }
        
        .ai-route-content.open {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .route-info {
            padding: 12px 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.4);
        }
        
        .route-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.6);
            padding: 8px 12px;
            border-radius: 8px;
        }
        
        .stat-label {
            font-size: 11px;
            opacity: 0.9;
            margin-bottom: 2px;
            color: #0c4a6e;
        }
        
        .stat-value {
            font-size: 16px;
            font-weight: bold;
            color: #0c4a6e;
        }
        
        .route-list {
            background: rgba(255, 255, 255, 0.4);
            border-radius: 8px;
            padding: 8px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .route-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            margin-bottom: 6px;
            background: rgba(255, 255, 255, 0.95);
            color: #1f2937;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .route-item-left {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .route-number {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #0ea5e9;
            color: white;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .route-room-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .route-room {
            font-weight: 600;
        }
        
        .route-floor {
            font-size: 12px;
            color: #6b7280;
        }
        
        .route-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .route-select {
            padding: 4px 8px;
            font-size: 13px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }
        
        .route-select.cleaning-red {
            border-color: #fca5a5;
            background: #fef2f2;
        }
        
        .route-select.cleaning-green {
            border-color: #86efac;
            background: #f0fdf4;
        }
        
        .route-select.cleaning-gray {
            border-color: #d1d5db;
            background: #f9fafb;
        }
        
        .efficiency-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: rgba(255, 255, 255, 0.8);
            color: #0ea5e9;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        /* 清掃グラフセクション */
        .graph-section {
            background: linear-gradient(135deg, #e6e6ff 0%, #cfd0ff 100%);
            color: #0c4a6e;
            margin: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .graph-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            cursor: pointer;
        }
        
        .graph-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 14px;
        }
        
        .graph-icon {
            width: 20px;
            height: 20px;
        }
        
        .graph-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: rgba(255, 255, 255, 0.3);
        }
        
        .graph-content.open {
            max-height: 400px;
        }
        
        .graph-container {
            padding: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.4);
            position: relative;
        }
        
        .graph-summary {
            background: rgba(255, 255, 255, 0.6);
            padding: 10px 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            text-align: center;
        }
        
        .graph-chart {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 16px;
            position: relative;
        }
        
        .today-button {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 4px 12px;
            background: #f97316;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            z-index: 10;
            transition: all 0.2s;
        }
        
        .today-button:hover {
            background: #ea580c;
        }
        
        .today-button:active {
            transform: scale(0.95);
        }
        
        .graph-scroll-container {
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            margin-top: 30px;
        }
        
        .graph-scroll-container::-webkit-scrollbar {
            height: 6px;
        }
        
        .graph-scroll-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }
        
        .graph-scroll-container::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
        }
        
        .graph-bars {
            display: flex;
            align-items: flex-end;
            height: 120px;
            gap: 4px;
            min-width: max-content;
            padding: 0 4px;
            position: relative;
        }
        
        .graph-bar-container {
            width: 24px;
            height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            position: relative;
        }
        
        .graph-bar {
            width: 100%;
            background: linear-gradient(to top, #0ea5e9, #38bdf8);
            border-radius: 3px 3px 0 0;
            transition: all 0.3s ease;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
        }
        
        .graph-bar.today {
            background: linear-gradient(to top, #f97316, #fb923c);
            box-shadow: 0 0 8px rgba(249, 115, 22, 0.4);
            width: 28px;
            margin: 0 -2px;
            z-index: 5;
        }
        
        .graph-bar.past {
            background: linear-gradient(to top, #94a3b8, #cbd5e1);
        }
        
        .graph-bar-value {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            font-weight: bold;
            color: #0c4a6e;
            white-space: nowrap;
            z-index: 10;
        }
        
        .graph-bar.today .graph-bar-value {
            font-size: 11px;
            color: #f97316;
        }
        
        .graph-labels {
            display: flex;
            gap: 4px;
            margin-top: 6px;
            padding-top: 6px;
            border-top: 1px solid #e5e7eb;
            min-width: max-content;
            padding: 6px 4px 0;
        }
        
        .graph-label {
            width: 24px;
            text-align: center;
            font-size: 9px;
            color: #0c4a6e;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .graph-label.today {
            font-weight: bold;
            color: #f97316;
            font-size: 10px;
            width: 28px;
        }
        
        /* フィルターバー */
        .filter-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: white;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .filter-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .floor-buttons {
            display: flex;
            gap: 4px;
        }
        
        .floor-btn {
            padding: 8px 6px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            color: #6b7280;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 36px;
        }
        
        .sort-buttons {
            display: flex;
            gap: 4px;
        }
        
        .sort-btn {
            padding: 6px 8px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            color: #6b7280;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .sort-btn:hover {
            background: #f3f4f6;
        }
        
        .sort-btn:active {
            transform: scale(0.95);
        }
        
        .sort-btn.active {
            background: #2563eb;
            border-color: #2563eb;
            color: white;
        }
        
        .sort-icon {
            width: 12px;
            height: 12px;
        }
        
        .floor-btn:active {
            transform: scale(0.95);
        }
        
        .floor-btn.active {
            background: #2563eb;
            border-color: #2563eb;
            color: white;
        }
        
        .calendar-btn {
            padding: 8px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .calendar-btn:hover {
            background: #f3f4f6;
        }
        
        .calendar-btn:active {
            transform: scale(0.95);
        }
        
        /* 部屋リスト */
        .room-list {
            padding: 12px 16px 80px;
        }
        
        .room-card {
            margin-bottom: 8px;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .room-card:active {
            transform: scale(0.98);
        }
        
        .room-card.status-gray {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        
        .room-card.status-red {
            background: #fef2f2;
            border-color: #fecaca;
        }
        
        .room-card.status-green {
            background: #f0fdf4;
            border-color: #bbf7d0;
        }
        
        .room-card.status-blue {
            background: #eff6ff;
            border-color: #bfdbfe;
        }
        
        .room-card.status-purple {
            background: #faf5ff;
            border-color: #ddd6fe;
        }
        
        .room-card.status-orange {
            background: #fff7ed;
            border-color: #fed7aa;
        }
        
        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .room-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .room-number {
            font-size: 18px;
            font-weight: bold;
            color: #1f2937;
        }
        
        .room-type {
            font-size: 11px;
            color: #4b5563;
            font-weight: 500;
        }
        
        .room-status {
            padding: 4px 12px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 6px;
        }
        
        .room-status.unused {
            background: #f3f4f6;
            color: #374151;
        }
        
        .room-status.before-ci {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .room-status.staying {
            background: #fef3c7;
            color: #92400e;
        }
        
        .room-status.after-co {
            background: #fed7aa;
            color: #9a3412;
        }
        
        .room-icons {
            display: flex;
            gap: 8px;
        }
        
        .icon {
            width: 16px;
            height: 16px;
        }
        
        .icon-blue {
            color: #2563eb;
        }
        
        .icon-purple {
            color: #7c3aed;
        }
        
        .room-tag {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
            white-space: nowrap;
        }
        
        .tag-blue {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .tag-purple {
            background: #fecaca;
            color: #dc2626;
        }
        
        .room-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .select {
            padding: 4px 8px;
            font-size: 14px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }
        
        .select.cleaning-red {
            border-color: #fca5a5;
            background: #fef2f2;
        }
        
        .select.cleaning-green {
            border-color: #86efac;
            background: #f0fdf4;
        }
        
        .select.cleaning-gray {
            border-color: #d1d5db;
            background: #f9fafb;
        }
        
        .select.cleaning-blue {
            border-color: #93c5fd;
            background: #eff6ff;
        }
        
        .select.cleaning-purple {
            border-color: #c4b5fd;
            background: #faf5ff;
        }
        
        .select.cleaning-orange {
            border-color: #fdba74;
            background: #fff7ed;
        }
        
        .room-time-info {
            margin-top: 4px;
            font-size: 12px;
            color: #6b7280;
            display: flex;
            gap: 12px;
        }
        
        .time-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .time-label {
            color: #9ca3af;
        }
        
        .time-value {
            font-weight: 500;
            color: #374151;
        }
        
        /* 週間カレンダー */
        .weekly-calendar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }
        
        .weekly-calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .weekly-calendar-title {
            font-size: 18px;
            font-weight: bold;
            color: #1f2937;
        }
        
        .weekly-calendar-close {
            padding: 8px;
            background: none;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .weekly-calendar-close:hover {
            background: #f3f4f6;
        }
        
        .weekly-calendar-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .week-nav-btn {
            padding: 8px;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .week-nav-btn:hover {
            background: #f3f4f6;
        }
        
        .week-nav-btn:active {
            transform: scale(0.95);
        }
        
        .week-display {
            font-weight: 600;
            color: #374151;
        }
        
        .weekly-calendar-scroll {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        .room-column {
            width: 80px;
            background: #f8fafc;
            border-right: 2px solid #d1d5db;
            overflow-y: hidden;
        }
        
        .calendar-content {
            flex: 1;
            overflow-x: auto;
            overflow-y: auto;
        }
        
        .weekly-calendar-grid {
            min-width: 500px;
            background: white;
        }
        
        .weekly-calendar-header-row {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e5e7eb;
            overflow: hidden;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .room-header-cell {
            background: #f3f4f6;
            padding: 15px 8px;
            font-weight: 600;
            font-size: 12px;
            color: #374151;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            position: sticky;
            top: 0;
            z-index: 10;
            min-height: 50px;
        }
        
        .day-header-cell {
            background: #f3f4f6;
            padding: 12px 8px;
            font-weight: 600;
            font-size: 11px;
            color: #374151;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 50px;
        }
        
        .day-header-cell.today {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .weekly-calendar-row {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e5e7eb;
            margin-bottom: 1px;
        }
        
        .room-cell {
            background: white;
            padding: 8px;
            font-weight: 600;
            font-size: 12px;
            color: #374151;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 60px;
            border-right: 1px solid #e5e7eb;
        }
        
        .status-cell {
            background: white;
            padding: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .status-cell:hover {
            background: #f9fafb;
        }
        
        .status-cell.needs-cleaning {
            background: #fef2f2;
            border: 1px solid #fca5a5;
        }
        
        .status-cell.cleaned {
            background: #f0fdf4;
            border: 1px solid #86efac;
        }
        
        .status-cell.no-cleaning {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
        }
        
        .status-cell.occupied {
            background: #fef3c7;
            border: 1px solid #fbbf24;
        }
        
        .reservation-bar {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            height: 20px;
            border-radius: 10px;
            font-size: 10px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            z-index: 3;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .reservation-checkin {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
        }
        
        .reservation-staying {
            background: linear-gradient(45deg, #f59e0b, #d97706);
        }
        
        .reservation-checkout {
            background: linear-gradient(45deg, #ef4444, #dc2626);
        }
        
        .room-status-text {
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .cleaning-status-text {
            font-size: 9px;
            color: #6b7280;
        }
        
        .check-times {
            font-size: 8px;
            color: #9ca3af;
            margin-top: 2px;
        }
        
        /* モーダル */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 50;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .modal-close {
            padding: 4px;
            background: none;
            border: none;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 16px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            color: #4b5563;
            margin-bottom: 4px;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-static {
            padding: 8px 12px;
            background: #f3f4f6;
            border-radius: 4px;
            color: #374151;
        }
        
        .image-upload {
            border: 2px dashed #d1d5db;
            border-radius: 4px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
        }
        
        .image-upload-label {
            color: #6b7280;
            cursor: pointer;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .btn-primary {
            background: #2563eb;
            color: white;
        }
        
        .btn-secondary {
            background: white;
            color: #4b5563;
            border: 1px solid #d1d5db;
        }
        
        .btn-full {
            width: 100%;
            padding: 12px;
        }
        
        .btn-group {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }
        
        .btn-group .btn {
            flex: 1;
        }
        
        .checkbox-group {
            margin-bottom: 8px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            cursor: pointer;
        }
        
        .checkbox-label:hover {
            background: #f9fafb;
        }
        
        svg {
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <!-- ログイン選択画面 -->
    <div class="login-container" id="loginScreen">
        <div class="login-card">
            <h1 class="login-title">清掃管理システム</h1>
            <div class="login-buttons">
                <button class="login-btn admin" onclick="login('admin')">
                    <svg class="login-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path>
                    </svg>
                    管理者
                </button>
                <button class="login-btn cleaner" onclick="login('cleaner')">
                    <svg class="login-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                    </svg>
                    清掃担当
                </button>
            </div>
        </div>
    </div>
    
    <!-- メインアプリケーション -->
    <div class="app-container" id="mainApp">
    <div class="container">
        <!-- ヘッダー -->
        <div class="header">
            <div class="header-content">
                <div class="date-selector">
                    <button class="date-btn" onclick="previousDay()">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <div class="date-display">
                        <span id="currentDate">8月7日</span>
                        <button onclick="showCalendar()" style="background: none; border: none; cursor: pointer; padding: 4px;">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </button>
                    </div>
                    <button class="date-btn" onclick="nextDay()">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                </div>
                <div class="user-info">
                    <span class="user-role" id="userRole">管理者</span>
                    <button class="logout-btn" onclick="logout()">ログアウト</button>
                </div>
            </div>
        </div>
        
        <!-- 施設選択 -->
        <div class="facility-selector">
            <select class="facility-dropdown" id="facilitySelect" onchange="changeFacility()">
                <option value="demo-hotel-a">デモホテルA</option>
                <option value="demo-hotel-b">デモホテルB</option>
                <option value="demo-hotel-c">デモホテルC</option>
            </select>
        </div>

        <!-- 清掃グラフ -->
        <div class="graph-section">
            <div class="graph-header" onclick="toggleGraph()">
                <div class="graph-title">
                    <svg class="graph-icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M3 13h2v8H3zm4-8h2v16H7zm4-2h2v18h-2zm4 4h2v14h-2zm4-4h2v18h-2z"/>
                    </svg>
                    <span>週間清掃推移</span>
                </div>
                <svg class="toggle-icon" id="graphToggleIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </div>
            <div class="graph-content" id="graphContent">
                <div class="graph-container">
                    <div class="graph-summary" id="graphSummary">
                        今日は昨日より2部屋多く清掃が必要です
                    </div>
                    <div class="graph-chart">
                        <button class="today-button" onclick="scrollToToday()">今日</button>
                        <div class="graph-scroll-container" id="graphScrollContainer">
                            <div class="graph-bars" id="graphBars">
                                <!-- 動的に生成 -->
                            </div>
                            <div class="graph-labels" id="graphLabels">
                                <!-- 動的に生成 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ステータスサマリー -->
        <div class="status-summary">
            <div class="status-scroll-container">
                <button class="scroll-arrow left" onclick="scrollStatusLeft()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                <div class="status-grid" id="statusGrid">
                    <button class="status-btn" onclick="filterByStatus('未清掃')" id="filter-未清掃">
                        <div class="status-content">
                            <span>未清掃</span>
                            <span class="status-count" id="count-未清掃">4</span>
                        </div>
                    </button>
                    <button class="status-btn" onclick="filterByStatus('清掃済')" id="filter-清掃済">
                        <div class="status-content">
                            <span>清掃済</span>
                            <span class="status-count" id="count-清掃済">3</span>
                        </div>
                    </button>
                    <button class="status-btn" onclick="filterByStatus('点検済')" id="filter-点検済">
                        <div class="status-content">
                            <span>点検済</span>
                            <span class="status-count" id="count-点検済">2</span>
                        </div>
                    </button>
                    <button class="status-btn" onclick="filterByStatus('DD')" id="filter-DD">
                        <div class="status-content">
                            <span>DD</span>
                            <span class="status-count" id="count-DD">2</span>
                        </div>
                    </button>
                    <button class="status-btn" onclick="filterByStatus('清掃不要')" id="filter-清掃不要">
                        <div class="status-content">
                            <span>清掃不要</span>
                            <span class="status-count" id="count-清掃不要">2</span>
                        </div>
                    </button>
                    <button class="status-btn" onclick="filterByStatus('early')" id="filter-early">
                        <div class="status-content">
                            <span>アーリー</span>
                            <span class="status-count" id="count-early">2</span>
                        </div>
                    </button>
                    <button class="status-btn" onclick="filterByStatus('late')" id="filter-late">
                        <div class="status-content">
                            <span>レイト</span>
                            <span class="status-count" id="count-late">2</span>
                        </div>
                    </button>
                </div>
                <button class="scroll-arrow right" onclick="scrollStatusRight()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- フィルターバー -->
        <div class="filter-bar">
            <div class="filter-controls">
                <div class="floor-buttons">
                    <button class="floor-btn" onclick="toggleFloor(1)" id="floor-1">1F</button>
                    <button class="floor-btn" onclick="toggleFloor(2)" id="floor-2">2F</button>
                    <button class="floor-btn" onclick="toggleFloor(3)" id="floor-3">3F</button>
                    <button class="floor-btn" onclick="toggleFloor(4)" id="floor-4">4F</button>
                    <button class="floor-btn" onclick="toggleFloor(5)" id="floor-5">5F</button>
                </div>
                <div class="sort-buttons">
                    <button class="sort-btn" onclick="toggleSort('room')" id="sort-room">
                        <span>123</span>
                        <svg class="sort-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" id="sort-room-icon">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"></path>
                        </svg>
                    </button>
                    <button class="sort-btn" onclick="toggleSort('type')" id="sort-type">
                        <span>Type</span>
                        <svg class="sort-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" id="sort-type-icon">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <button class="calendar-btn" onclick="toggleWeeklyCalendar()">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
            </button>
        </div>
        
        <!-- 部屋リスト -->
        <div class="room-list" id="roomList"></div>
        
        <!-- 週間カレンダービュー -->
        <div class="weekly-calendar" id="weeklyCalendar" style="display: none;">
            <div class="weekly-calendar-header">
                <h3 class="weekly-calendar-title">週間清掃スケジュール</h3>
                <button class="weekly-calendar-close" onclick="closeWeeklyCalendar()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="weekly-calendar-navigation">
                <button class="week-nav-btn" onclick="previousWeek()">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                <span id="weekDisplay" class="week-display">2025年8月7日 - 8月13日</span>
                <button class="week-nav-btn" onclick="nextWeek()">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </button>
            </div>
            <div class="weekly-calendar-scroll">
                <div class="room-column">
                    <div class="room-header-cell">部屋</div>
                    <div id="roomColumnContent"></div>
                </div>
                <div class="calendar-content">
                    <div class="weekly-calendar-grid">
                        <div class="weekly-calendar-header-row">
                            <div class="day-header-cell" id="day1Header">8/7</div>
                            <div class="day-header-cell" id="day2Header">8/8</div>
                            <div class="day-header-cell" id="day3Header">8/9</div>
                            <div class="day-header-cell" id="day4Header">8/10</div>
                            <div class="day-header-cell" id="day5Header">8/11</div>
                            <div class="day-header-cell" id="day6Header">8/12</div>
                            <div class="day-header-cell" id="day7Header">8/13</div>
                        </div>
                        <div id="weeklyCalendarContent"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- カレンダーモーダル -->
    <div class="modal" id="calendarModal">
        <div class="modal-content" style="max-width: 320px;">
            <div class="modal-header">
                <h3 class="modal-title">日付選択</h3>
                <button class="modal-close" onclick="closeCalendar()">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <input type="date" id="calendarInput" class="form-input" style="width: 100%; font-size: 16px;">
                <div class="btn-group" style="margin-top: 12px;">
                    <button class="btn btn-secondary" onclick="closeCalendar()">キャンセル</button>
                    <button class="btn btn-primary" onclick="selectDate()">選択</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 部屋詳細モーダル -->
    <div class="modal" id="roomDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">部屋 <span id="detailRoomNumber"></span></h3>
                <button class="modal-close" onclick="closeRoomDetail()">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">清掃ステータス</label>
                    <select class="form-select" id="detailCleaningStatus">
                        <option value="未清掃">未清掃</option>
                        <option value="清掃済">清掃済</option>
                        <option value="点検済">点検済</option>
                        <option value="DD">DD</option>
                        <option value="清掃不要">清掃不要</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">部屋ステータス</label>
                    <div class="form-static" id="detailRoomStatus"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">清掃者</label>
                    <select class="form-select" id="detailCleaner">
                        <option value="">担当者未定</option>
                        <option value="田中">田中</option>
                        <option value="佐藤">佐藤</option>
                        <option value="鈴木">鈴木</option>
                        <option value="山田">山田</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">画像</label>
                    <div class="image-upload">
                        <input type="file" accept="image/*" style="display: none;" id="imageUpload">
                        <label for="imageUpload" class="image-upload-label">
                            <svg width="32" height="32" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin: 0 auto 8px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            <div id="imageStatus">画像を追加</div>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">清掃メモ</label>
                    <textarea class="form-textarea" id="detailMemo" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">忘れ物</label>
                    <textarea class="form-textarea" id="detailLostItem" rows="2"></textarea>
                </div>
                <button class="btn btn-primary btn-full" onclick="saveRoomDetail()">保存</button>
            </div>
        </div>
    </div>
    
    <!-- 確認モーダル -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div style="padding: 16px;">
                <h3 style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">変更確認</h3>
                <p style="color: #4b5563; margin-bottom: 16px;" id="confirmMessage"></p>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="cancelChange()">キャンセル</button>
                    <button class="btn btn-primary" onclick="confirmChange()">変更</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // データ
        let currentDate = new Date();
        let activeFilter = null;
        let selectedFloors = [];
        let currentEditingRoom = null;
        let pendingChange = null;
        let aiRouteOpen = false;
        let graphOpen = false;
        
        const rooms = [
            { id: 101, number: '101', floor: 1, roomType: 'シングル', roomStatus: '未使用', cleaningStatus: '清掃済', cleanerName: '田中', earlyCheckIn: false, lateCheckOut: false, checkInTime: '', checkOutTime: '', memo: '', lostItem: '' },
            { id: 102, number: '102', floor: 1, roomType: 'ダブル', roomStatus: 'CI前', cleaningStatus: '点検済', cleanerName: '佐藤', earlyCheckIn: true, lateCheckOut: false, checkInTime: '15:00', checkOutTime: '', memo: '', lostItem: '' },
            { id: 103, number: '103', floor: 1, roomType: 'ツイン', roomStatus: '滞在中', cleaningStatus: '清掃不要', cleanerName: '', earlyCheckIn: false, lateCheckOut: false, checkInTime: '', checkOutTime: '11:00', memo: '', lostItem: '' },
            { id: 201, number: '201', floor: 2, roomType: 'シングル', roomStatus: 'CO済', cleaningStatus: '未清掃', cleanerName: '', earlyCheckIn: false, lateCheckOut: true, checkInTime: '', checkOutTime: '12:00', memo: '', lostItem: '' },
            { id: 202, number: '202', floor: 2, roomType: 'ダブル', roomStatus: '滞在中', cleaningStatus: 'DD', cleanerName: '鈴木', earlyCheckIn: false, lateCheckOut: false, checkInTime: '', checkOutTime: '11:00', memo: '', lostItem: '' },
            { id: 203, number: '203', floor: 2, roomType: 'スイート', roomStatus: 'CO済', cleaningStatus: '未清掃', cleanerName: '', earlyCheckIn: false, lateCheckOut: false, checkInTime: '', checkOutTime: '10:30', memo: '', lostItem: '' },
            { id: 301, number: '301', floor: 3, roomType: 'シングル', roomStatus: 'CI前', cleaningStatus: '清掃済', cleanerName: '山田', earlyCheckIn: false, lateCheckOut: false, checkInTime: '15:00', checkOutTime: '', memo: '', lostItem: '' },
            { id: 302, number: '302', floor: 3, roomType: 'ツイン', roomStatus: '滞在中', cleaningStatus: '清掃不要', cleanerName: '', earlyCheckIn: false, lateCheckOut: false, checkInTime: '', checkOutTime: '11:00', memo: '', lostItem: '' },
            { id: 303, number: '303', floor: 3, roomType: 'ダブル', roomStatus: 'CO済', cleaningStatus: '未清掃', cleanerName: '', earlyCheckIn: false, lateCheckOut: false, checkInTime: '', checkOutTime: '10:45', memo: '', lostItem: '' },
            { id: 401, number: '401', floor: 4, roomType: 'スイート', roomStatus: '未使用', cleaningStatus: '点検済', cleanerName: '田中', earlyCheckIn: false, lateCheckOut: false, checkInTime: '', checkOutTime: '', memo: '', lostItem: '' },
            { id: 402, number: '402', floor: 4, roomType: 'シングル', roomStatus: 'CO済', cleaningStatus: '未清掃', cleanerName: '', earlyCheckIn: true, lateCheckOut: false, checkInTime: '13:00', checkOutTime: '09:30', memo: '', lostItem: '' },
            { id: 501, number: '501', floor: 5, roomType: 'ダブル', roomStatus: 'CI前', cleaningStatus: 'DD', cleanerName: '', earlyCheckIn: false, lateCheckOut: true, checkInTime: '15:00', checkOutTime: '12:30', memo: '', lostItem: '' },
            { id: 502, number: '502', floor: 5, roomType: 'ツイン', roomStatus: '滞在中', cleaningStatus: '清掃済', cleanerName: '佐藤', earlyCheckIn: false, lateCheckOut: false, checkInTime: '', checkOutTime: '11:00', memo: '', lostItem: '' },
        ];
        
        // 週間データ（デモ用）
        const weeklyData = [
            { date: -5, count: 8 },
            { date: -4, count: 10 },
            { date: -3, count: 7 },
            { date: -2, count: 9 },
            { date: -1, count: 4 },  // 昨日
            { date: 0, count: 6 },   // 今日
            { date: 1, count: 8 }    // 明日
        ];
        
        // AI清掃ルート計算
        function calculateAIRoute() {
            const needsCleaning = rooms.filter(r => r.cleaningStatus === '未清掃');
            
            // 優先度順にソート（CO済 > CI前 > アーリーCI > その他）
            const sorted = needsCleaning.sort((a, b) => {
                const getPriority = (room) => {
                    if (room.roomStatus === 'CO済') return 1;
                    if (room.earlyCheckIn) return 2;
                    if (room.roomStatus === 'CI前') return 3;
                    return 4;
                };
                
                const priorityDiff = getPriority(a) - getPriority(b);
                if (priorityDiff !== 0) return priorityDiff;
                
                // 同じ優先度なら階数順
                return a.floor - b.floor;
            });
            
            // 階数を最適化（エレベーター移動を最小化）
            const optimized = [];
            const floors = [...new Set(sorted.map(r => r.floor))].sort();
            
            floors.forEach(floor => {
                const floorRooms = sorted.filter(r => r.floor === floor);
                optimized.push(...floorRooms);
            });
            
            return optimized;
        }
        
        // AI清掃ルート表示
        function renderAIRoute() {
            const route = calculateAIRoute();
            const routeList = document.getElementById('routeList');
            
            if (route.length === 0) {
                routeList.innerHTML = '<div style="text-align: center; padding: 20px; color: #0c4a6e;">清掃が必要な部屋はありません</div>';
                return;
            }
            
            const currentTime = new Date();
            currentTime.setHours(9, 30, 0); // 開始時刻 9:30
            let totalMinutes = 0;
            
            routeList.innerHTML = route.map((room, index) => {
                const cleaningTime = room.roomStatus === 'CO済' ? 25 : 15; // CO済は25分、その他15分
                totalMinutes += cleaningTime;
                
                const cleaningClass = {
                    '未清掃': 'cleaning-red',
                    '清掃済': 'cleaning-green',
                    '清掃不要': 'cleaning-gray'
                }[room.cleaningStatus] || '';
                
                return `
                    <div class="route-item">
                        <div class="route-item-left">
                            <div class="route-number">${index + 1}</div>
                            <div class="route-room-info">
                                <span class="route-room">${room.number}</span>
                                <span class="route-floor">${room.floor}F</span>
                            </div>
                        </div>
                        <div class="route-controls">
                            <select class="route-select ${cleaningClass}" 
                                    onclick="event.stopPropagation()" 
                                    onchange="confirmRouteCleaningChange(${room.id}, this.value)">
                                <option value="未清掃" ${room.cleaningStatus === '未清掃' ? 'selected' : ''}>未清掃</option>
                                <option value="清掃済" ${room.cleaningStatus === '清掃済' ? 'selected' : ''}>清掃済</option>
                                <option value="清掃不要" ${room.cleaningStatus === '清掃不要' ? 'selected' : ''}>清掃不要</option>
                            </select>
                            <select class="route-select" 
                                    onclick="event.stopPropagation()" 
                                    onchange="confirmRouteCleanerChange(${room.id}, this.value)">
                                <option value="" ${!room.cleanerName ? 'selected' : ''}>未定</option>
                                <option value="田中" ${room.cleanerName === '田中' ? 'selected' : ''}>田中</option>
                                <option value="佐藤" ${room.cleanerName === '佐藤' ? 'selected' : ''}>佐藤</option>
                                <option value="鈴木" ${room.cleanerName === '鈴木' ? 'selected' : ''}>鈴木</option>
                                <option value="山田" ${room.cleanerName === '山田' ? 'selected' : ''}>山田</option>
                            </select>
                        </div>
                    </div>
                `;
            }).join('');
            
            // 完了時刻と総所要時間を更新
            const endTime = new Date(currentTime);
            endTime.setMinutes(endTime.getMinutes() + totalMinutes);
            document.getElementById('estimatedTime').textContent = 
                `${endTime.getHours()}:${String(endTime.getMinutes()).padStart(2, '0')}`;
            
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            document.getElementById('totalTime').textContent = 
                hours > 0 ? `${hours}時間${minutes}分` : `${minutes}分`;
        }
        
        // AI清掃ルート内の変更確認
        function confirmRouteCleaningChange(roomId, newStatus) {
            const room = rooms.find(r => r.id === roomId);
            pendingChange = { room, field: 'cleaningStatus', oldValue: room.cleaningStatus, newValue: newStatus };
            document.getElementById('confirmMessage').textContent = 
                `部屋${room.number}の清掃ステータスを「${room.cleaningStatus}」から「${newStatus}」に変更しますか？`;
            document.getElementById('confirmModal').classList.add('active');
        }
        
        function confirmRouteCleanerChange(roomId, newCleaner) {
            const room = rooms.find(r => r.id === roomId);
            pendingChange = { room, field: 'cleanerName', oldValue: room.cleanerName, newValue: newCleaner };
            const oldName = room.cleanerName || '未定';
            const newName = newCleaner || '未定';
            document.getElementById('confirmMessage').textContent = 
                `部屋${room.number}の清掃者を「${oldName}」から「${newName}」に変更しますか？`;
            document.getElementById('confirmModal').classList.add('active');
        }
        
        // AI清掃ルートトグル
        function toggleAIRoute() {
            aiRouteOpen = !aiRouteOpen;
            const content = document.getElementById('aiRouteContent');
            const icon = document.getElementById('aiToggleIcon');
            
            if (aiRouteOpen) {
                content.classList.add('open');
                icon.classList.add('open');
                renderAIRoute();
            } else {
                content.classList.remove('open');
                icon.classList.remove('open');
            }
        }
        
        // 清掃グラフトグル
        function toggleGraph() {
            graphOpen = !graphOpen;
            const content = document.getElementById('graphContent');
            const icon = document.getElementById('graphToggleIcon');
            
            if (graphOpen) {
                content.classList.add('open');
                icon.classList.add('open');
                renderGraph();
            } else {
                content.classList.remove('open');
                icon.classList.remove('open');
            }
        }
        
        // グラフ描画
        function renderGraph() {
            // 1ヶ月分のデータを生成（今日を中心に前後15日）
            const monthlyData = [];
            for (let i = -15; i <= 15; i++) {
                const date = new Date(currentDate);
                date.setDate(date.getDate() + i);
                
                // デモ用のランダムデータ（実際は日付に応じたデータを取得）
                let count;
                if (i === 0) {
                    // 今日は実際の未清掃数
                    count = rooms.filter(r => r.cleaningStatus === '未清掃').length;
                } else {
                    // その他の日はランダム（0〜12部屋）で変化を付ける
                    count = Math.floor(Math.random() * 13);
                }
                
                monthlyData.push({
                    date: i,
                    count: count,
                    actualDate: date
                });
            }
            
            // 今日と昨日のデータ
            const today = monthlyData.find(d => d.date === 0).count;
            const yesterday = monthlyData.find(d => d.date === -1).count;
            
            // サマリー更新
            const summary = document.getElementById('graphSummary');
            const diff = today - yesterday;
            if (diff > 0) {
                summary.textContent = `今日は昨日より${diff}部屋多く清掃が必要です`;
            } else if (diff < 0) {
                summary.textContent = `今日は昨日より${Math.abs(diff)}部屋少ない清掃です`;
            } else {
                summary.textContent = '今日は昨日と同じ清掃数です';
            }
            
            // 最大値を取得
            const maxCount = Math.max(...monthlyData.map(d => d.count));
            
            // バー描画
            const barsContainer = document.getElementById('graphBars');
            const labelsContainer = document.getElementById('graphLabels');
            
            barsContainer.innerHTML = monthlyData.map((data, index) => {
                // 高さを計算：最大値を70%の高さとして、それに対する比率で計算
                // 0件でも最小2%の高さを確保
                let height;
                if (maxCount > 0) {
                    height = Math.max(2, (data.count / maxCount) * 70);
                } else {
                    height = 2;
                }
                
                const isToday = data.date === 0;
                const isPast = data.date < 0;
                const barClass = isToday ? 'today' : isPast ? 'past' : '';
                
                return `
                    <div class="graph-bar-container">
                        <div class="graph-bar-value">${data.count}</div>
                        <div class="graph-bar ${barClass}" 
                             style="height: ${height}%;"></div>
                    </div>
                `;
            }).join('');
            
            // ラベル描画
            const weekdays = ['日', '月', '火', '水', '木', '金', '土'];
            labelsContainer.innerHTML = monthlyData.map((data, index) => {
                const weekday = weekdays[data.actualDate.getDay()];
                const isToday = data.date === 0;
                const day = data.actualDate.getDate();
                const month = data.actualDate.getMonth() + 1;
                
                let label;
                if (isToday) {
                    label = '今日';
                } else if (data.date === -1) {
                    label = '昨日';
                } else if (data.date === 1) {
                    label = '明日';
                } else {
                    label = `${month}/${day}`;
                }
                
                return `
                    <div class="graph-label ${isToday ? 'today' : ''}">${label}</div>
                `;
            }).join('');
            
            // 今日を中心にスクロール
            setTimeout(() => {
                scrollToToday();
            }, 100);
        }
        
        // 今日の位置までスクロール
        function scrollToToday() {
            const scrollContainer = document.getElementById('graphScrollContainer');
            if (scrollContainer) {
                const containerWidth = scrollContainer.offsetWidth;
                const totalWidth = scrollContainer.scrollWidth;
                const todayPosition = (15 / 30) * totalWidth; // 今日の位置（15番目/31日分）
                const scrollPosition = todayPosition - (containerWidth / 2) + 14; // 今日のバーの幅の半分を調整
                
                scrollContainer.scrollTo({
                    left: scrollPosition,
                    behavior: 'smooth'
                });
            }
        }
        
        // 初期化
        function init() {
            updateDate();
            updateCounts();
            renderRooms();
            renderAIRoute();
            updateSortButtons(); // ソートボタンの初期状態を設定
        }
        
        // ステータスボタンのスクロール機能
        function scrollStatusLeft() {
            const statusGrid = document.getElementById('statusGrid');
            statusGrid.scrollBy({ left: -200, behavior: 'smooth' });
        }
        
        function scrollStatusRight() {
            const statusGrid = document.getElementById('statusGrid');
            statusGrid.scrollBy({ left: 200, behavior: 'smooth' });
        }
        
        // 施設変更
        function changeFacility() {
            const facilitySelect = document.getElementById('facilitySelect');
            const selectedFacility = facilitySelect.value;
            console.log('施設変更:', selectedFacility);
            // 現在は何も変更しない（将来の拡張用）
        }
        
        // 日付更新
        function updateDate() {
            const month = currentDate.getMonth() + 1;
            const day = currentDate.getDate();
            document.getElementById('currentDate').textContent = `${month}月${day}日`;
        }
        
        // カウント更新
        function updateCounts() {
            document.getElementById('count-未清掃').textContent = rooms.filter(r => r.cleaningStatus === '未清掃').length;
            document.getElementById('count-清掃済').textContent = rooms.filter(r => r.cleaningStatus === '清掃済').length;
            document.getElementById('count-点検済').textContent = rooms.filter(r => r.cleaningStatus === '点検済').length;
            document.getElementById('count-DD').textContent = rooms.filter(r => r.cleaningStatus === 'DD').length;
            document.getElementById('count-清掃不要').textContent = rooms.filter(r => r.cleaningStatus === '清掃不要').length;
            document.getElementById('count-early').textContent = rooms.filter(r => r.earlyCheckIn).length;
            document.getElementById('count-late').textContent = rooms.filter(r => r.lateCheckOut).length;
        }
        
        // 部屋一覧描画
        function renderRooms() {
            let filteredRooms = [...rooms];
            
            // フロアフィルター（選択されたフロアがある場合のみ適用）
            if (selectedFloors.length > 0) {
                filteredRooms = filteredRooms.filter(room => selectedFloors.includes(room.floor));
            }
            
            // ステータスフィルター
            if (activeFilter) {
                if (activeFilter === 'early') {
                    filteredRooms = filteredRooms.filter(room => room.earlyCheckIn);
                } else if (activeFilter === 'late') {
                    filteredRooms = filteredRooms.filter(room => room.lateCheckOut);
                } else {
                    filteredRooms = filteredRooms.filter(room => room.cleaningStatus === activeFilter);
                }
            }
            
            // ソート適用
            if (currentSort.type === 'room') {
                filteredRooms.sort((a, b) => {
                    const comparison = a.number.localeCompare(b.number);
                    return currentSort.direction === 'asc' ? comparison : -comparison;
                });
            } else if (currentSort.type === 'type') {
                filteredRooms.sort((a, b) => {
                    const comparison = a.roomType.localeCompare(b.roomType);
                    return currentSort.direction === 'asc' ? comparison : -comparison;
                });
            }
            
            const roomList = document.getElementById('roomList');
            
            if (filteredRooms.length === 0) {
                roomList.innerHTML = '<div style="text-align: center; padding: 40px; color: #9ca3af;">該当する部屋がありません</div>';
                return;
            }
            
            roomList.innerHTML = filteredRooms.map(room => {
                const cardClass = room.cleaningStatus === '清掃不要' ? 'status-gray' :
                                 room.cleaningStatus === '未清掃' ? 'status-red' :
                                 room.cleaningStatus === '清掃済' ? 'status-green' :
                                 room.cleaningStatus === '点検済' ? 'status-blue' :
                                 room.cleaningStatus === 'DD' ? 'status-purple' : 'status-orange';
                
                const statusClass = {
                    '未使用': 'unused',
                    'CI前': 'before-ci',
                    '滞在中': 'staying',
                    'CO済': 'after-co'
                }[room.roomStatus] || '';
                
                const cleaningClass = {
                    '未清掃': 'cleaning-red',
                    '清掃済': 'cleaning-green',
                    '点検済': 'cleaning-blue',
                    'DD': 'cleaning-purple',
                    '清掃不要': 'cleaning-gray'
                }[room.cleaningStatus] || '';
                
                // チェックイン・チェックアウト時間の表示用文字列を作成
                const timeInfoItems = [];
                if (room.checkInTime && (room.roomStatus === 'CI前' || room.roomStatus === 'CO済')) {
                    timeInfoItems.push(`<div class="time-item"><span class="time-label">CI:</span><span class="time-value">${room.checkInTime}</span></div>`);
                }
                if (room.checkOutTime && (room.roomStatus === 'CO済' || room.roomStatus === '滞在中')) {
                    timeInfoItems.push(`<div class="time-item"><span class="time-label">CO:</span><span class="time-value">${room.checkOutTime}</span></div>`);
                }
                
                const timeInfoHtml = timeInfoItems.length > 0 ? `<div class="room-time-info">${timeInfoItems.join('')}</div>` : '';

                return `
                    <div class="room-card ${cardClass}" onclick="openRoomDetail(${room.id})">
                        <div class="room-header">
                            <div class="room-info">
                                <span class="room-number">${room.number}</span>
                                <span class="room-type">${room.roomType}</span>
                            </div>
                            <div class="room-icons">
                                ${room.earlyCheckIn ? '<span class="room-tag tag-blue">アーリーC/I</span>' : ''}
                                ${room.lateCheckOut ? '<span class="room-tag tag-purple">レイトC/O</span>' : ''}
                            </div>
                        </div>
                        ${timeInfoHtml}
                        <div class="room-controls">
                            <select class="select ${cleaningClass}" onclick="event.stopPropagation()" onchange="confirmCleaningStatusChange(${room.id}, this.value)">
                                <option value="未清掃" ${room.cleaningStatus === '未清掃' ? 'selected' : ''}>未清掃</option>
                                <option value="清掃済" ${room.cleaningStatus === '清掃済' ? 'selected' : ''}>清掃済</option>
                                <option value="点検済" ${room.cleaningStatus === '点検済' ? 'selected' : ''}>点検済</option>
                                <option value="DD" ${room.cleaningStatus === 'DD' ? 'selected' : ''}>DD</option>
                                <option value="清掃不要" ${room.cleaningStatus === '清掃不要' ? 'selected' : ''}>清掃不要</option>
                            </select>
                            <span class="room-status ${statusClass}">${room.roomStatus}</span>
                            <select class="select" onclick="event.stopPropagation()" onchange="confirmCleanerChange(${room.id}, this.value)">
                                <option value="" ${!room.cleanerName ? 'selected' : ''}>担当者未定</option>
                                <option value="田中" ${room.cleanerName === '田中' ? 'selected' : ''}>田中</option>
                                <option value="佐藤" ${room.cleanerName === '佐藤' ? 'selected' : ''}>佐藤</option>
                                <option value="鈴木" ${room.cleanerName === '鈴木' ? 'selected' : ''}>鈴木</option>
                                <option value="山田" ${room.cleanerName === '山田' ? 'selected' : ''}>山田</option>
                            </select>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // 日付操作
        function previousDay() {
            currentDate.setDate(currentDate.getDate() - 1);
            updateDate();
        }
        
        function nextDay() {
            currentDate.setDate(currentDate.getDate() + 1);
            updateDate();
        }
        
        function showCalendar() {
            const year = currentDate.getFullYear();
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const day = String(currentDate.getDate()).padStart(2, '0');
            document.getElementById('calendarInput').value = `${year}-${month}-${day}`;
            document.getElementById('calendarModal').classList.add('active');
        }
        
        function closeCalendar() {
            document.getElementById('calendarModal').classList.remove('active');
        }
        
        function selectDate() {
            const input = document.getElementById('calendarInput');
            if (input.value) {
                currentDate = new Date(input.value + 'T00:00:00');
                updateDate();
                closeCalendar();
            }
        }
        
        // フィルター
        function filterByStatus(status) {
            const buttons = {
                '未清掃': 'active-red',
                '清掃済': 'active-green',
                '点検済': 'active-blue',
                'DD': 'active-purple',
                '清掃不要': 'active-gray',
                'early': 'active-blue',
                'late': 'active-purple'
            };
            
            // リセット
            Object.keys(buttons).forEach(key => {
                const btn = document.getElementById(`filter-${key}`);
                if (btn) {
                    btn.className = 'status-btn';
                }
            });
            
            if (activeFilter === status) {
                activeFilter = null;
            } else {
                activeFilter = status;
                const btn = document.getElementById(`filter-${status}`);
                btn.classList.add(buttons[status]);
            }
            
            renderRooms();
        }
        
        function toggleFloor(floor) {
            const btn = document.getElementById(`floor-${floor}`);
            const index = selectedFloors.indexOf(floor);
            
            if (index > -1) {
                // 既に選択されている場合は削除
                selectedFloors.splice(index, 1);
                btn.classList.remove('active');
            } else {
                // 選択されていない場合は追加
                selectedFloors.push(floor);
                btn.classList.add('active');
            }
            
            renderRooms();
        }
        
        // 部屋詳細
        function openRoomDetail(roomId) {
            const room = rooms.find(r => r.id === roomId);
            currentEditingRoom = room;
            
            document.getElementById('detailRoomNumber').textContent = room.number;
            document.getElementById('detailRoomStatus').textContent = room.roomStatus;
            document.getElementById('detailCleaningStatus').value = room.cleaningStatus;
            document.getElementById('detailCleaner').value = room.cleanerName;
            document.getElementById('detailMemo').value = room.memo || '';
            document.getElementById('detailLostItem').value = room.lostItem || '';
            
            document.getElementById('roomDetailModal').classList.add('active');
        }
        
        function closeRoomDetail() {
            document.getElementById('roomDetailModal').classList.remove('active');
            currentEditingRoom = null;
        }
        
        function saveRoomDetail() {
            if (currentEditingRoom) {
                currentEditingRoom.cleaningStatus = document.getElementById('detailCleaningStatus').value;
                currentEditingRoom.cleanerName = document.getElementById('detailCleaner').value;
                currentEditingRoom.memo = document.getElementById('detailMemo').value;
                currentEditingRoom.lostItem = document.getElementById('detailLostItem').value;
                
                updateCounts();
                renderRooms();
                renderAIRoute(); // AI清掃ルートも更新
                closeRoomDetail();
            }
        }
        
        // 確認モーダル
        function confirmCleaningStatusChange(roomId, newStatus) {
            const room = rooms.find(r => r.id === roomId);
            pendingChange = { room, field: 'cleaningStatus', oldValue: room.cleaningStatus, newValue: newStatus };
            document.getElementById('confirmMessage').textContent = 
                `部屋${room.number}の清掃ステータスを「${room.cleaningStatus}」から「${newStatus}」に変更しますか？`;
            document.getElementById('confirmModal').classList.add('active');
        }
        
        function confirmCleanerChange(roomId, newCleaner) {
            const room = rooms.find(r => r.id === roomId);
            pendingChange = { room, field: 'cleanerName', oldValue: room.cleanerName, newValue: newCleaner };
            const oldName = room.cleanerName || '未定';
            const newName = newCleaner || '未定';
            document.getElementById('confirmMessage').textContent = 
                `部屋${room.number}の清掃者を「${oldName}」から「${newName}」に変更しますか？`;
            document.getElementById('confirmModal').classList.add('active');
        }
        
        function confirmChange() {
            if (pendingChange) {
                pendingChange.room[pendingChange.field] = pendingChange.newValue;
                updateCounts();
                renderRooms();
                renderAIRoute(); // AI清掃ルートも更新
            }
            document.getElementById('confirmModal').classList.remove('active');
            pendingChange = null;
        }
        
        function cancelChange() {
            renderRooms();
            document.getElementById('confirmModal').classList.remove('active');
            pendingChange = null;
        }
        
        // 画像アップロード
        document.getElementById('imageUpload').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                document.getElementById('imageStatus').textContent = '画像が選択されました';
                document.getElementById('imageStatus').style.color = '#16a34a';
            }
        });
        
        // 週間カレンダー機能
        let currentWeekOffset = 0;
        let currentSort = { type: 'room', direction: 'asc' };

        function toggleWeeklyCalendar() {
            const calendar = document.getElementById('weeklyCalendar');
            calendar.style.display = 'flex';
            generateWeeklyCalendarData();
        }

        function closeWeeklyCalendar() {
            const calendar = document.getElementById('weeklyCalendar');
            calendar.style.display = 'none';
        }

        function previousWeek() {
            currentWeekOffset--;
            generateWeeklyCalendarData();
        }

        function nextWeek() {
            currentWeekOffset++;
            generateWeeklyCalendarData();
        }

        function generateWeeklyCalendarData() {
            // 現在の日付から週の開始日を計算
            const startDate = new Date(currentDate);
            startDate.setDate(startDate.getDate() + (currentWeekOffset * 7));
            
            // 週の日曜日を取得
            const weekStart = new Date(startDate);
            weekStart.setDate(startDate.getDate() - startDate.getDay());
            
            // 7日分の日付を生成
            const weekDates = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(weekStart);
                date.setDate(weekStart.getDate() + i);
                weekDates.push(date);
            }
            
            // ヘッダーの週表示を更新
            const weekStartStr = `${weekStart.getMonth() + 1}/${weekStart.getDate()}`;
            const weekEndDate = new Date(weekStart);
            weekEndDate.setDate(weekStart.getDate() + 6);
            const weekEndStr = `${weekEndDate.getMonth() + 1}/${weekEndDate.getDate()}`;
            document.querySelector('.weekly-calendar-title').textContent = 
                `予約カレンダー (${weekStartStr} - ${weekEndStr})`;
            
            // 日付ヘッダーを更新
            weekDates.forEach((date, index) => {
                const headerCell = document.getElementById(`day${index + 1}Header`);
                headerCell.textContent = `${date.getMonth() + 1}/${date.getDate()}`;
            });
            
            // 部屋番号列を生成
            const roomColumn = document.getElementById('roomColumnContent');
            roomColumn.innerHTML = rooms.map(room => 
                `<div class="room-cell">${room.number}</div>`
            ).join('');
            
            // カレンダーコンテンツを生成（予約期間表示）
            const content = document.getElementById('weeklyCalendarContent');
            const roomRows = rooms.map(room => {
                const reservations = generateReservationsForRoom(room, weekDates);
                const roomCells = weekDates.map((date, dayIndex) => {
                    const reservation = reservations.find(r => 
                        dayIndex >= r.startDay && dayIndex <= r.endDay
                    );
                    
                    if (reservation && dayIndex === reservation.startDay) {
                        // 予約期間の開始日
                        const width = (reservation.endDay - reservation.startDay + 1) * 100;
                        return `
                            <div class="status-cell">
                                <div class="reservation-bar reservation-${reservation.type}" 
                                     style="width: ${width}%; left: 0;">
                                    ${reservation.nights}泊
                                </div>
                            </div>
                        `;
                    } else if (reservation && dayIndex > reservation.startDay) {
                        // 予約期間の継続日（空セル）
                        return `<div class="status-cell"></div>`;
                    } else {
                        // 予約なし
                        return `<div class="status-cell"></div>`;
                    }
                }).join('');
                
                return `
                    <div class="weekly-calendar-row">
                        ${roomCells}
                    </div>
                `;
            }).join('');
            
            content.innerHTML = roomRows;
            
            // スクロール同期を設定
            syncScrolling();
        }
        
        function generateReservationsForRoom(room, weekDates) {
            // ランダムに予約期間を生成
            const reservations = [];
            const random = Math.random();
            
            // 30%の確率で予約なし
            if (random < 0.3) return reservations;
            
            // ランダムな予約を1-2個生成
            const numReservations = random < 0.7 ? 1 : 2;
            
            for (let i = 0; i < numReservations; i++) {
                const startDay = Math.floor(Math.random() * 5); // 0-4日目から開始
                const nights = Math.floor(Math.random() * 3) + 1; // 1-3泊
                const endDay = Math.min(startDay + nights - 1, 6); // 6日目まで
                
                // 既存の予約と重複チェック
                const overlaps = reservations.some(r => 
                    startDay <= r.endDay && endDay >= r.startDay
                );
                
                if (!overlaps) {
                    const types = ['checkin', 'staying', 'checkout'];
                    reservations.push({
                        startDay,
                        endDay,
                        nights: endDay - startDay + 1,
                        type: types[Math.floor(Math.random() * types.length)]
                    });
                }
            }
            
            return reservations;
        }

        function generateRoomStatusForDate(room, date) {
            // 実際のシステムでは予約データから取得
            // ここではデモ用のランダムデータを生成
            const dayOfWeek = date.getDay();
            const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
            const random = Math.random();
            
            // 週末は稼働率が高い
            if (isWeekend) {
                if (random < 0.7) return 'needs-cleaning';
                if (random < 0.9) return 'cleaned';
                return 'occupied';
            } else {
                // 平日は稼働率が低め
                if (random < 0.4) return 'needs-cleaning';
                if (random < 0.6) return 'cleaned';
                if (random < 0.8) return 'no-cleaning';
                return 'occupied';
            }
        }

        // スクロール同期機能
        function syncScrolling() {
            const roomColumn = document.querySelector('.room-column');
            const calendarContent = document.querySelector('.calendar-content');
            
            if (!roomColumn || !calendarContent) return;
            
            // 同期フラグ（無限ループ防止）
            let isSyncing = false;
            
            // カレンダーコンテンツのスクロールに合わせて部屋列をスクロール
            calendarContent.addEventListener('scroll', function() {
                if (isSyncing) return;
                isSyncing = true;
                roomColumn.scrollTop = calendarContent.scrollTop;
                setTimeout(() => { isSyncing = false; }, 10);
            });
            
            // 部屋列のスクロールに合わせてカレンダーコンテンツをスクロール
            roomColumn.addEventListener('scroll', function() {
                if (isSyncing) return;
                isSyncing = true;
                calendarContent.scrollTop = roomColumn.scrollTop;
                setTimeout(() => { isSyncing = false; }, 10);
            });
        }

        // ソート機能
        function toggleSort(type) {
            if (currentSort.type === type) {
                // 同じソートタイプの場合、方向を切り替え
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                // 新しいソートタイプの場合、昇順で開始
                currentSort.type = type;
                currentSort.direction = 'asc';
            }
            
            // ソートボタンのスタイルを更新
            updateSortButtons();
            
            // 部屋リストを再描画
            renderRooms();
        }
        
        function updateSortButtons() {
            // すべてのソートボタンをリセット
            document.getElementById('sort-room').classList.remove('active');
            document.getElementById('sort-type').classList.remove('active');
            
            // アクティブなソートボタンを設定
            const activeBtn = document.getElementById(`sort-${currentSort.type}`);
            activeBtn.classList.add('active');
            
            // 矢印アイコンを更新
            const iconSvg = currentSort.direction === 'asc' 
                ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"></path>'
                : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 13l-5 5m0 0l-5-5m5 5V6"></path>';
            
            document.getElementById(`sort-${currentSort.type}-icon`).innerHTML = iconSvg;
            
            // 非アクティブな矢印を上向きにリセット
            const inactiveType = currentSort.type === 'room' ? 'type' : 'room';
            document.getElementById(`sort-${inactiveType}-icon`).innerHTML = 
                '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"></path>';
        }

        // ログイン機能
        let currentUser = null;
        
        function login(userType) {
            currentUser = userType;
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').classList.add('active');
            
            // ユーザータイプに応じて表示をカスタマイズ
            if (userType === 'admin') {
                document.getElementById('userRole').textContent = '管理者';
                // 管理者用の機能を表示
                showAdminFeatures();
            } else {
                document.getElementById('userRole').textContent = '清掃担当';
                // 清掃担当用の機能を表示（一部機能を非表示に）
                showCleanerFeatures();
            }
            
            // メインアプリの初期化
            init();
        }
        
        function logout() {
            currentUser = null;
            document.getElementById('mainApp').classList.remove('active');
            document.getElementById('loginScreen').style.display = 'flex';
        }
        
        function showAdminFeatures() {
            // 管理者は全機能を利用可能
            // AI清掃ルートセクションを表示
            const aiRouteSection = document.querySelector('.ai-route-section');
            if (aiRouteSection) {
                aiRouteSection.style.display = 'block';
            }
            
            // グラフセクションを表示
            const graphSection = document.querySelector('.graph-section');
            if (graphSection) {
                graphSection.style.display = 'block';
            }
        }
        
        function showCleanerFeatures() {
            // 清掃担当は一部機能のみ
            // AI清掃ルートセクションを非表示
            const aiRouteSection = document.querySelector('.ai-route-section');
            if (aiRouteSection) {
                aiRouteSection.style.display = 'none';
            }
            
            // グラフセクションを非表示
            const graphSection = document.querySelector('.graph-section');
            if (graphSection) {
                graphSection.style.display = 'none';
            }
        }

        // 初期化を条件付きに変更
        // init(); // ログイン後に呼ばれるように変更
    </script>
    </div>
    </div>
</body>
</html>